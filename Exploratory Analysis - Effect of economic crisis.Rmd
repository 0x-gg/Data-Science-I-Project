---
title: "Preliminary Analysis - Effect of Economic Crisis"
author: "Sneha Vasanth, Janani Kumar, Tigh Bradley, Gaurav Gada"
date: "February 21, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyr)
library(dplyr)
```

### Conduct a first-pass descriptive analysis of your dataset. Produce tables and graphs that show exactly what data you have, and that contain summary statistics about the data. Questions to answer for each data source include:

Cleaning up the data!

```{r load_cpi}
cpi = read.csv("CPI_World_Bank.csv",check.names = FALSE)
#Get country and indicator column names and remove spaces using make.names
country_indicator_names <- make.names(names(cpi[c(1:4)])) 
#country_indicator_names

#Get year column names
year_column_names <- names(cpi[c(5:ncol(cpi))])
#year_column_names

#Reassign the modified column names to actual column names
names(cpi) <- c(country_indicator_names,year_column_names)

#Gather all year column names into a new column called Year and assign its values to a column called CPI
clean_cpi <- gather(cpi,Year,CPI,-Country.Name,-Country.Code,-Indicator.Name,-Indicator.Code)
cpi_data <- clean_cpi[,!colnames(clean_cpi) %in% c("Indicator.Name","Indicator.Code")]


cpi = read.csv("CPI_World_Bank.csv",check.names = FALSE)
#Get country and indicator column names and remove spaces using make.names
country_indicator_names <- make.names(names(cpi[c(1:4)]))
#country_indicator_names

#Get year column names
year_column_names <- names(cpi[c(5:ncol(cpi))])
#year_column_names

#Reassign the modified column names to actual column names
names(cpi) <- c(country_indicator_names,year_column_names)

#Gather all year column names into a new column called Year and assign its values to a column called CPI
clean_cpi <- gather(cpi,Year,CPI,-Country.Name,-Country.Code,-Indicator.Name,-Indicator.Code)
cpi_data <- clean_cpi[,!colnames(clean_cpi) %in% c("Indicator.Name","Indicator.Code")]

unemp = read.csv("Unemployment_ILO.csv",check.names = FALSE)
country_indicator_names <- make.names(names(unemp[c(1:4)])) 
#country_indicator_names

#Get year column names
year_column_names <- names(unemp[c(5:ncol(unemp))])
#year_column_names

#Reassign the modified column names to actual column names
names(unemp) <- c(country_indicator_names,year_column_names)

#Gather all year column names into a new column called Year and assign its values to a column called unemp
clean_unemp <- gather(unemp,Year,unemp,-Country.Name,-Country.Code,-Indicator.Name,-Indicator.Code)
unemp_data <- clean_unemp[,!colnames(clean_unemp) %in% c("Indicator.Name","Indicator.Code")]

#Get country and indicator column names and remove spaces using make.names
country_indicator_names <- make.names(names(unemp[c(1:4)]))
#country_indicator_names

#Get year column names
year_column_names <- names(unemp[c(5:ncol(unemp))])
#year_column_names

#Reassign the modified column names to actual column names
names(unemp) <- c(country_indicator_names,year_column_names)

#Gather all year column names into a new column called Year and assign its values to a column called unemp
clean_unemp <- gather(unemp,Year,unemp,-Country.Name,-Country.Code,-Indicator.Name,-Indicator.Code)
unemp_data <- clean_unemp[,!colnames(clean_unemp) %in% c("Indicator.Name","Indicator.Code")]

gdp = read.csv("gdp.csv",check.names = FALSE)
country_indicator_names <- make.names(names(gdp[c(1:4)])) 
#country_indicator_names

#Get year column names
year_column_names <- names(gdp[c(5:ncol(gdp))])
#year_column_names

#Reassign the modified column names to actual column names
names(gdp) <- c(country_indicator_names,year_column_names)

#Gather all year column names into a new column called Year and assign its values to a column called gdp
clean_gdp <- gather(gdp,Year,gdp,-Country.Name,-Country.Code,-Indicator.Name,-Indicator.Code)
gdp_data <- clean_gdp[,!colnames(clean_gdp) %in% c("Indicator.Name","Indicator.Code")]

#Get country and indicator column names and remove spaces using make.names
country_indicator_names <- make.names(names(gdp[c(1:4)]))
#country_indicator_names

#Get year column names
year_column_names <- names(gdp[c(5:ncol(gdp))])
#year_column_names

#Reassign the modified column names to actual column names
names(gdp) <- c(country_indicator_names,year_column_names)

#Gather all year column names into a new column called Year and assign its values to a column called gdp
clean_gdp <- gather(gdp,Year,gdp,-Country.Name,-Country.Code,-Indicator.Name,-Indicator.Code)
gdp_data <- clean_gdp[,!colnames(clean_gdp) %in% c("Indicator.Name","Indicator.Code")]

# Join all data
gdp_cpi = merge(gdp_data, cpi_data, by=c("Country.Code","Year"), all = T) # NA's match

labor_data = merge(gdp_cpi, unemp_data, by=c("Country.Code","Year"), all = T) # NA's match

drops = c("Country.Name.y","Country.Name.x")
labor_data = labor_data[ , !(names(labor_data) %in% drops)]

names(labor_data)

labor_data = labor_data[c("Country.Name", "Country.Code", "Year", "gdp", "unemp", "CPI")]

# Clean up data
labor_data = labor_data[!(is.na(labor_data$unemp) & is.na(labor_data$CPI) & is.na(labor_data$gdp)),]

# Clean up the working space
rm(list = ls()[grep("labor", ls(), invert = T)])

attach(labor_data)
```


### How many unique observations to you have?

The number of unique observations for CPI, GDP and unemployment respectively are:

```{r}
nrow(labor_data[!is.na(CPI),])
nrow(labor_data[!is.na(gdp),])
nrow(labor_data[!is.na(unemp),])
```

### What information/features/characteristics do you have for each observation?

```{r}
# TODO
```


### What are the min/max/mean/median/sd values for each of these features?

```{r summary_stats_cpi}
summary(labor_data$CPI,na.rm = TRUE)
sd(labor_data$CPI, na.rm = TRUE)

summary(labor_data$gdp,na.rm = TRUE)
sd(labor_data$gdp, na.rm = TRUE)

summary(labor_data$unemp,na.rm = TRUE)
sd(labor_data$unemp, na.rm = TRUE)
```

### What is the distribution of the core features (show a histogram)?

```{r hist_cpi}
ggplot(labor_data, aes(x = CPI)) +
  geom_histogram(fill = "white",
                 color = "black",
                 binwidth = 5)

ggplot(labor_data, aes(x = gdp)) +
  geom_histogram(fill = "white",
                 color = "black",
                 binwidth = 500) +
  xlim(0, 75000)

ggplot(labor_data, aes(x = unemp)) +
  geom_histogram(fill = "white",
                 color = "black",
                 binwidth = 0.5)
```
# TODO write on these

CPI seems to be right skewed.

### Are there obvious trends in the data (over time, across subgroups, etc.), and are the differences statistically significant?

```{r plot_trends}

cpi_data_1 <- labor_data %>%
  select(Country.Name,Country.Code,Year,CPI) %>%
  filter(Year >= 2000 & Year<= 2015 & Country.Code == "USA") %>%
  group_by(Year)

ggplot(cpi_data_1,aes(x = Year, y = CPI))+geom_point(na.rm = TRUE) 
```


```{r}
cpi_data_2 <- labor_data %>%
  select(Country.Name,Country.Code,Year,CPI) %>%
  filter(Year >= 2000 & Year<= 2015 & (Country.Code =='IND' | Country.Code == 'CAN'| Country.Code == 'CHN' | Country.Code == 'USA')) %>%
  group_by(Year)

ggplot(cpi_data_2,aes(x = Year, y = CPI, col = Country.Code, group = Country.Code)) +geom_line(na.rm = T)


unemployment_data_1 <- labor_data %>%
  select(Country.Name,Country.Code,Year,unemp) %>%
  filter(Year >= 2000 & Year<= 2015 & (Country.Code =='IND' | Country.Code == 'CAN' | Country.Code == 'USA'|Country.Code == 'CHN')) %>%
  group_by(Year)

ggplot(unemployment_data_1, aes(x = Year, y = unemp,col = Country.Code, group = Country.Code))+geom_line(na.rm = T)
```

We see that the unemployment rates increases drastically in Canada and USA after 2007 crisis(2008 recession). 
The unemployment rates in China is stable wheras for India it decreases after the 2007 crisis.This can be due to increase in outsourcing.


### There is a steep CPI increase for India and the CPI of USA and Canada are comparitively more stable post the 2008 recession.


### What are the other salient aspects of the data (e.g. geospatial factors, text content, etc.)

We have data bound to the country code and we can explore gradient plots to visualize the changes in features over a period of time. Other than that the data doesn't have any special features.